<!DOCTYPE html>
<!-- 

          Alan's Page Counters - 26Feb23          
 
          
see: https://medium.com/@mignunez/how-to-count-the-number-of-visits-on-your-website-with-html-css-javascript-and-the-count-api-2f99b42b5990

create new counter: https://api.countapi.xyz/create?namespace=alanesqCNC&enable_reset=1

reset counter: https://api.countapi.xyz/set/alanesqCalculators/a4531941-8c3d-469c-8259-437ca09d4a73?value=0

read counter: https://api.countapi.xyz/get/alanesqCalculators/a4531941-8c3d-469c-8259-437ca09d4a73     

calculators:  {"namespace":"alanesqCalculators","key":"a4531941-8c3d-469c-8259-437ca09d4a73","value":0}
Schickard: {"namespace":"alanesqSchickard","key":"c2cd0dd0-f132-40f6-8c92-9f4d75485a1f","value":0}
CNC: {"namespace":"alanesqCNC","key":"5078ea3c-e4e8-4f74-91ac-49c680a21e72","value":0}

in HEAD add:  <script async src="https://api.countapi.xyz/hit/alanesqCalculators/a4531941-8c3d-469c-8259-437ca09d4a73?callback=websiteVisits"></script>  

add this javascript:          // visit counter (using countapi.xyz)
                                function websiteVisits(response) {
                                    document.querySelector("#visits").textContent = response.value;
                                }   

display with:  <span>Page visitors: <span id="visits"></span></span>  
          

-->
 
 
 <html style="direction: ltr;">
  <head>
    <title>Alan's Page Counters</title>
    <meta name="description" content="Alan's Page Counters">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="SHORTCUT ICON" href="/main/logo.ico">
    <link rel="stylesheet" href="/main/css/style.css">  
  </head>
  
  <body>

    <div style="text-align: center;">

      <!-- Banner at top of page -->
      <div class="header-footer" style="height: 10vw;">
          <img class="headerImg" src="/main/calculators/cat.gif" alt="Page logo 1" style="left: 12px;">
          <h1>Alan's Page Counters</h1>
          <img class="headerImg" src="/main/calculators/cat.gif" alt="Page logo 2" style="transform: scaleX(-1); right: 12px;">
      </div>       
      
      <br>
      <div id="results"></div>
      <input type="button" value="Reset Counters" onclick="resetCounters()"> 
      <br><br>

    <!-- If it is December display Festivus banner -->
        <div id='festivusDiv'></div>
        <script type="text/javascript" src="/main/js/festivus.js"></script>    

    <!-- show banner if 'alanesq.com/banner.gif' exists -->
        <div id='bannerDiv'></div>
        <script type="text/javascript" src="/main/js/banner.js"></script>    <!-- check if banner.gif exists and if it does insert html in to div above -->          
      
    <!-- Footer at bottom of page -->  
      <div class="header-footer" style="height: 5vh;">
          <input class="button" type="button" value="Return to previous page" onclick="history.back()"> 
          <input class="button" type="button" value="Alan's Homepage" onclick='window.location.href = "index.htm"'> 
          <span class="button">Contact: <a href="mailto:alanesq@disroot.org">alanesq@disroot.org</a></span>
      </div>

      
    <script> 
    
        // counters to display
          const counterList = [
            { name: "Calculators", id: "alanesqCalculators", key: "a4531941-8c3d-469c-8259-437ca09d4a73"},
            { name: "Schickard", id: "alanesqSchickard", key: "c2cd0dd0-f132-40f6-8c92-9f4d75485a1f"},
            { name: "CNC Router", id: "alanesqCNC", key: "5078ea3c-e4e8-4f74-91ac-49c680a21e72"}
          ]; 
          
    
        // get JSON data
          var getJSON = function(url, callback) {
              var xhr = new XMLHttpRequest();
              xhr.open('GET', url, true);
              xhr.responseType = 'json';
              xhr.onload = function() {
                var status = xhr.status;
                if (status === 200) {
                  callback(null, xhr.response);
                } else {
                  callback(status, xhr.response);
                }
              };
              xhr.send();
          };
          
        // GET request
          function httpGet(theUrl)
          {
              var xmlHttp = new XMLHttpRequest();
              xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
              xmlHttp.send( null );
              return xmlHttp.responseText;
          }        

          // Get counter values and display them
            counterList.forEach(counterData => {           
              getJSON("https://api.countapi.xyz/get/" + counterData.id +"/" + counterData.key ,
              function(err, data) {
                if (err !== null) {
                  console.log("Something went wrong " + counterData.name + ", " + err);
                } else {
                  console.log( counterData.name + " query count: " + data.value);
                  document.getElementById("results").innerHTML += counterData.name + ": " + data.value + "<br><br>";
                }
              });
            });
              
        // reset all counters
          function resetCounters() {
            counterList.forEach(counterData => { 
              httpGet("https://api.countapi.xyz/set/" + counterData.id + "/" + counterData.key + "?value=0");
            });
            location.reload();
          }
    
    </script>        
        
        
  </body>
</html>
